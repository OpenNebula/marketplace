---
name: Service OneKE 1.29 Airgapped
version: 1.29.4-6.10.0-1-20240510
publisher: OpenNebula Systems
description: |-
  [RKE2](https://docs.rke2.io/) based multi-master Kubernetes 1.29 Airgapped cluster for KVM and vCenter hosts,
  orchestrated by
  [OneFlow](https://docs.opennebula.io/stable/management_and_operations/multivm_service_management/appflow_elasticity.html).

  Requires
  [OneFlow](https://docs.opennebula.io/stable/management_and_operations/multivm_service_management/overview.html)
  and
  [OneGate](https://docs.opennebula.io/stable/management_and_operations/multivm_service_management/onegate_usage.html)
  OpenNebula components.

  See the dedicated [documentation](https://github.com/OpenNebula/one-apps/wiki).

  Based on VM templates
  - [OneKE 1.29 Airgapped](/appliance/2b7b85bb-ef57-43e3-9852-a97ab6087c7e)
  - [OneKE 1.29 VNF](/appliance/883d974f-f30e-4fc8-aa06-e1af2a020e49)
  - [OneKE 1.29 Airgapped Storage](/appliance/bcd5a3bc-1bcb-4158-acea-7e74c9950bd5)
short_description: >-
  Multi-master Kubernetes 1.29 Airgapped cluster for KVM and vCenter hosts,
  orchestrated by OneFlow
tags:
- kubernetes
- oneflow
- service
- ubuntu
creation_time: 1715358765
os-id: Ubuntu
os-release: 22.04 LTS
os-arch: x86_64
hypervisor: ALL
opennebula_version: 6.0, 6.2, 6.4, 6.6, 6.8, 6.10
opennebula_template:
  name: OneKE 1.29
  deployment: straight
  description: ''
  roles:
  - name: vnf
    cardinality: 1
    min_vms: 1
    vm_template_contents: |
      NIC = [
        NAME = "NIC0",
        NETWORK_ID = "$Public" ]
      NIC = [
        NAME = "NIC1",
        NETWORK_ID = "$Private" ]
      ONEAPP_VROUTER_ETH0_VIP0 = "$ONEAPP_VROUTER_ETH0_VIP0"
      ONEAPP_VROUTER_ETH1_VIP0 = "$ONEAPP_VROUTER_ETH1_VIP0"
      ONEAPP_VNF_HAPROXY_INTERFACES = "$ONEAPP_VNF_HAPROXY_INTERFACES"
      ONEAPP_VNF_HAPROXY_REFRESH_RATE = "$ONEAPP_VNF_HAPROXY_REFRESH_RATE"
      ONEAPP_VNF_HAPROXY_LB0_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB0_PORT = "$ONEAPP_VNF_HAPROXY_LB0_PORT"
      ONEAPP_VNF_HAPROXY_LB1_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB1_PORT = "$ONEAPP_VNF_HAPROXY_LB1_PORT"
      ONEAPP_VNF_HAPROXY_LB2_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB2_PORT = "$ONEAPP_VNF_HAPROXY_LB2_PORT"
      ONEAPP_VNF_HAPROXY_LB3_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB3_PORT = "$ONEAPP_VNF_HAPROXY_LB3_PORT"
      ONEAPP_VNF_DNS_ENABLED = "$ONEAPP_VNF_DNS_ENABLED"
      ONEAPP_VNF_DNS_INTERFACES = "$ONEAPP_VNF_DNS_INTERFACES"
      ONEAPP_VNF_DNS_NAMESERVERS = "$ONEAPP_VNF_DNS_NAMESERVERS"
      ONEAPP_VNF_NAT4_ENABLED = "$ONEAPP_VNF_NAT4_ENABLED"
      ONEAPP_VNF_NAT4_INTERFACES_OUT = "$ONEAPP_VNF_NAT4_INTERFACES_OUT"
      ONEAPP_VNF_ROUTER4_ENABLED = "$ONEAPP_VNF_ROUTER4_ENABLED"
      ONEAPP_VNF_ROUTER4_INTERFACES = "$ONEAPP_VNF_ROUTER4_INTERFACES"
    cooldown: 120
    elasticity_policies: []
    scheduled_policies: []
  - name: master
    parents:
    - vnf
    cardinality: 1
    min_vms: 1
    vm_template_contents: |
      NIC = [
        NAME = "NIC0",
        NETWORK_ID = "$Private" ]
      FALLBACK_GW = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      FALLBACK_DNS = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      ONEAPP_VROUTER_ETH0_VIP0 = "$ONEAPP_VROUTER_ETH0_VIP0"
      ONEAPP_VROUTER_ETH1_VIP0 = "$ONEAPP_VROUTER_ETH1_VIP0"
      ONEAPP_RKE2_SUPERVISOR_EP = "$ONEAPP_RKE2_SUPERVISOR_EP"
      ONEAPP_K8S_CONTROL_PLANE_EP = "$ONEAPP_K8S_CONTROL_PLANE_EP"
      ONEAPP_K8S_EXTRA_SANS = "$ONEAPP_K8S_EXTRA_SANS"
      ONEAPP_K8S_MULTUS_ENABLED = "$ONEAPP_K8S_MULTUS_ENABLED"
      ONEAPP_K8S_MULTUS_CONFIG = "$ONEAPP_K8S_MULTUS_CONFIG"
      ONEAPP_K8S_CNI_PLUGIN = "$ONEAPP_K8S_CNI_PLUGIN"
      ONEAPP_K8S_CNI_CONFIG = "$ONEAPP_K8S_CNI_CONFIG"
      ONEAPP_K8S_CILIUM_RANGE = "$ONEAPP_K8S_CILIUM_RANGE"
      ONEAPP_K8S_LONGHORN_ENABLED = "$ONEAPP_K8S_LONGHORN_ENABLED"
      ONEAPP_K8S_METALLB_ENABLED = "$ONEAPP_K8S_METALLB_ENABLED"
      ONEAPP_K8S_METALLB_CONFIG = "$ONEAPP_K8S_METALLB_CONFIG"
      ONEAPP_K8S_METALLB_RANGE = "$ONEAPP_K8S_METALLB_RANGE"
      ONEAPP_K8S_TRAEFIK_ENABLED = "$ONEAPP_K8S_TRAEFIK_ENABLED"
      ONEAPP_VNF_HAPROXY_LB0_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB0_PORT = "$ONEAPP_VNF_HAPROXY_LB0_PORT"
      ONEAPP_VNF_HAPROXY_LB1_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB1_PORT = "$ONEAPP_VNF_HAPROXY_LB1_PORT"
      ONEAPP_VNF_DNS_ENABLED = "$ONEAPP_VNF_DNS_ENABLED"
    cooldown: 120
    elasticity_policies: []
    scheduled_policies: []
  - name: worker
    parents:
    - vnf
    cardinality: 1
    vm_template_contents: |
      NIC = [
        NAME = "NIC0",
        NETWORK_ID = "$Private" ]
      FALLBACK_GW = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      FALLBACK_DNS = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      ONEAPP_VROUTER_ETH0_VIP0 = "$ONEAPP_VROUTER_ETH0_VIP0"
      ONEAPP_VROUTER_ETH1_VIP0 = "$ONEAPP_VROUTER_ETH1_VIP0"
      ONEAPP_RKE2_SUPERVISOR_EP = "$ONEAPP_RKE2_SUPERVISOR_EP"
      ONEAPP_K8S_CONTROL_PLANE_EP = "$ONEAPP_K8S_CONTROL_PLANE_EP"
      ONEAPP_K8S_MULTUS_ENABLED = "$ONEAPP_K8S_MULTUS_ENABLED"
      ONEAPP_K8S_CNI_PLUGIN = "$ONEAPP_K8S_CNI_PLUGIN"
      ONEAPP_K8S_LONGHORN_ENABLED = "$ONEAPP_K8S_LONGHORN_ENABLED"
      ONEAPP_K8S_METALLB_ENABLED = "$ONEAPP_K8S_METALLB_ENABLED"
      ONEAPP_K8S_TRAEFIK_ENABLED = "$ONEAPP_K8S_TRAEFIK_ENABLED"
      ONEAPP_VNF_HAPROXY_LB0_PORT = "$ONEAPP_VNF_HAPROXY_LB0_PORT"
      ONEAPP_VNF_HAPROXY_LB1_PORT = "$ONEAPP_VNF_HAPROXY_LB1_PORT"
      ONEAPP_VNF_HAPROXY_LB2_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB2_PORT = "$ONEAPP_VNF_HAPROXY_LB2_PORT"
      ONEAPP_VNF_HAPROXY_LB3_IP = "<ETH0_EP0>"
      ONEAPP_VNF_HAPROXY_LB3_PORT = "$ONEAPP_VNF_HAPROXY_LB3_PORT"
      ONEAPP_VNF_DNS_ENABLED = "$ONEAPP_VNF_DNS_ENABLED"
    cooldown: 120
    elasticity_policies: []
    scheduled_policies: []
  - name: storage
    parents:
    - vnf
    cardinality: 0
    vm_template_contents: |
      NIC = [
        NAME = "NIC0",
        NETWORK_ID = "$Private" ]
      FALLBACK_GW = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      FALLBACK_DNS = "${vnf.TEMPLATE.CONTEXT.ETH1_IP}"
      ONEAPP_VROUTER_ETH0_VIP0 = "$ONEAPP_VROUTER_ETH0_VIP0"
      ONEAPP_VROUTER_ETH1_VIP0 = "$ONEAPP_VROUTER_ETH1_VIP0"
      ONEAPP_RKE2_SUPERVISOR_EP = "$ONEAPP_RKE2_SUPERVISOR_EP"
      ONEAPP_K8S_CONTROL_PLANE_EP = "$ONEAPP_K8S_CONTROL_PLANE_EP"
      ONEAPP_K8S_MULTUS_ENABLED = "$ONEAPP_K8S_MULTUS_ENABLED"
      ONEAPP_K8S_CNI_PLUGIN = "$ONEAPP_K8S_CNI_PLUGIN"
      ONEAPP_K8S_LONGHORN_ENABLED = "$ONEAPP_K8S_LONGHORN_ENABLED"
      ONEAPP_STORAGE_DEVICE = "$ONEAPP_STORAGE_DEVICE"
      ONEAPP_STORAGE_FILESYSTEM = "$ONEAPP_STORAGE_FILESYSTEM"
      ONEAPP_VNF_HAPROXY_LB0_PORT = "$ONEAPP_VNF_HAPROXY_LB0_PORT"
      ONEAPP_VNF_HAPROXY_LB1_PORT = "$ONEAPP_VNF_HAPROXY_LB1_PORT"
      ONEAPP_VNF_DNS_ENABLED = "$ONEAPP_VNF_DNS_ENABLED"
    cooldown: 120
    elasticity_policies: []
    scheduled_policies: []
  networks:
    public: 'M|network|Public||id:'
    private: 'M|network|Private||id:'
  custom_attrs:
    oneapp_vrouter_eth0_vip0: O|text|Control Plane Endpoint VIP (IPv4)||
    oneapp_vrouter_eth1_vip0: O|text|Default Gateway VIP (IPv4)||
    oneapp_rke2_supervisor_ep: O|text|RKE2 Supervisor endpoint||ep0.eth0.vr:9345
    oneapp_k8s_control_plane_ep: O|text|Control Plane endpoint||ep0.eth0.vr:6443
    oneapp_k8s_extra_sans: >-
      O|text|ApiServer extra certificate SANs||localhost,127.0.0.1,ep0.eth0.vr,${vnf.TEMPLATE.CONTEXT.ETH0_IP}
    oneapp_k8s_multus_enabled: O|boolean|Enable Multus||NO
    oneapp_k8s_multus_config: O|text64|Multus custom config (default none)||
    oneapp_k8s_cni_plugin: O|list|CNI plugin supported by RKE2|canal,calico,cilium|cilium
    oneapp_k8s_cni_config: O|text64|CNI custom config (default none)||
    oneapp_k8s_cilium_range: O|text|Cilium LB IP CIDR (default none)||
    oneapp_k8s_metallb_enabled: O|boolean|Enable MetalLB||NO
    oneapp_k8s_metallb_range: O|text|MetalLB IP range (default none)||
    oneapp_k8s_metallb_config: O|text64|MetalLB custom config (default none)||
    oneapp_k8s_longhorn_enabled: O|boolean|Enable Longhorn||NO
    oneapp_storage_device: O|text|Storage device path||/dev/vdb
    oneapp_storage_filesystem: O|text|Storage device filesystem||xfs
    oneapp_k8s_traefik_enabled: O|boolean|Enable Traefik||NO
    oneapp_vnf_haproxy_interfaces: O|text|Interfaces to run Haproxy on||eth0
    oneapp_vnf_haproxy_refresh_rate: O|number|Haproxy refresh rate||30
    oneapp_vnf_haproxy_lb0_port: O|number|HTTPS RKE2 Supervisor port||9345
    oneapp_vnf_haproxy_lb1_port: O|number|HTTPS API Server port||6443
    oneapp_vnf_haproxy_lb2_port: O|number|HTTPS ingress port||443
    oneapp_vnf_haproxy_lb3_port: O|number|HTTP ingress port||80
    oneapp_vnf_dns_enabled: O|boolean|Enable DNS recursor||YES
    oneapp_vnf_dns_interfaces: O|text|DNS - Interfaces||eth1
    oneapp_vnf_dns_nameservers: O|text|DNS - Nameservers||1.1.1.1,8.8.8.8
    oneapp_vnf_nat4_enabled: O|boolean|Enable NAT||YES
    oneapp_vnf_nat4_interfaces_out: O|text|NAT - Outgoing Interfaces||eth0
    oneapp_vnf_router4_enabled: O|boolean|Enable Router||YES
    oneapp_vnf_router4_interfaces: O|text|Router - Interfaces||eth0,eth1
  ready_status_gate: true
logo: kubernetes.png
type: SERVICE_TEMPLATE
roles:
  vnf: OneKE 1.29 VNF
  master: OneKE 1.29 Airgapped
  worker: OneKE 1.29 Airgapped
  storage: OneKE 1.29 Airgapped Storage
